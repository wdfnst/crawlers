<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!--This file was converted to xhtml by OpenOffice.org - see http://xml.openoffice.org/odf2xhtml for more info.--><head profile="http://dublincore.org/documents/dcmi-terms/"><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/><title xml:lang="en-US">Python Crawler Documents:</title><meta name="DCTERMS.title" content="Python Crawler Documents:" xml:lang="en-US"/><meta name="DCTERMS.language" content="en-US" scheme="DCTERMS.RFC4646"/><meta name="DCTERMS.source" content="http://xml.openoffice.org/odf2xhtml"/><meta name="DCTERMS.creator" content="Administrator"/><meta name="DCTERMS.issued" content="2011-12-25T17:07:18" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.modified" content="1899-12-30T08:00:00" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.provenance" content="" xml:lang="en-US"/><meta name="DCTERMS.subject" content="," xml:lang="en-US"/><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" hreflang="en"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" hreflang="en"/><link rel="schema.DCTYPE" href="http://purl.org/dc/dcmitype/" hreflang="en"/><link rel="schema.DCAM" href="http://purl.org/dc/dcam/" hreflang="en"/><style type="text/css">
	@page {  }
	table { border-collapse:collapse; border-spacing:0; empty-cells:show }
	td, th { vertical-align:top; font-size:12pt;}
	h1, h2, h3, h4, h5, h6 { clear:both }
	ol, ul { margin:0; padding:0;}
	li { list-style: none; margin:0; padding:0;}
	<!-- "li span.odfLiEnd" - IE 7 issue-->
	li span. { clear: both; line-height:0; width:0; height:0; margin:0; padding:0; }
	span.footnodeNumber { padding-right:1em; }
	span.annotation_style_by_filter { font-size:95%; font-family:Arial; background-color:#fff000;  margin:0; border:0; padding:0;  }
	* { margin:0;}
	.Heading_20_2 { font-size:16pt; text-align:justify ! important; font-family:Arial; writing-mode:lr-tb; margin-top:0.1807in; margin-bottom:0.1807in; line-height:172%; font-weight:bold; }
	.P1 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; }
	.P10 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; margin-left:0in; margin-right:0in; text-indent:0.2917in; }
	.P11 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; margin-left:0in; margin-right:0in; text-indent:0.2917in; }
	.P12 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; margin-left:0in; margin-right:0in; text-indent:0.2917in; background-color:#c0c0c0; }
	.P13 { font-size:22pt; font-weight:bold; line-height:200%; margin-bottom:0.2291in; margin-top:0.2362in; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; }
	.P14 { font-size:16pt; font-weight:bold; line-height:172%; margin-bottom:0.1807in; margin-top:0.1807in; text-align:justify ! important; font-family:Arial; writing-mode:lr-tb; }
	.P15 { font-size:12pt; font-weight:bold; line-height:172%; margin-bottom:0.1807in; margin-top:0.1807in; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; }
	.P2 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; color:#0000ff; }
	.P3 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; margin-left:0.2917in; margin-right:0in; text-indent:0.2917in; }
	.P4 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; margin-left:0.2917in; margin-right:0in; text-indent:0.2917in; }
	.P5_borderStart { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-bottom-style:none; }
	.P5 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none; border-bottom-style:none; }
	.P5_borderEnd { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none;}
	.P6_borderStart { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-bottom-style:none; }
	.P6 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none; border-bottom-style:none; }
	.P6_borderEnd { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none;}
	.P7_borderStart { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-bottom-style:none; }
	.P7 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none; border-bottom-style:none; }
	.P7_borderEnd { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none;}
	.P8_borderStart { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-bottom-style:none; }
	.P8 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none; border-bottom-style:none; }
	.P8_borderEnd { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none;}
	.P9_borderStart { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-bottom-style:none; }
	.P9 { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none; border-bottom-style:none; }
	.P9_borderEnd { font-size:12pt; text-align:justify ! important; font-family:Times New Roman; writing-mode:lr-tb; background-color:transparent; padding:0in; border-style:none;  border-top-style:none;}
	.Standard { font-size:12pt; font-family:Times New Roman; writing-mode:lr-tb; text-align:justify ! important; }
	.Table1 { width:5.3306in; margin-left:0.516in; writing-mode:lr-tb; }
	.Table2 { width:5.3201in; margin-left:0.5264in; writing-mode:lr-tb; }
	.Table3 { width:5.3146in; margin-left:0.5319in; writing-mode:lr-tb; }
	.Table1_A1 { vertical-align:top; padding-left:0.075in; padding-right:0.075in; padding-top:0in; padding-bottom:0in; border-width:0.0176cm; border-style:solid; border-color:#000000; writing-mode:lr-tb; }
	.Table2_A1 { vertical-align:top; background-color:#cccccc; padding-left:0.075in; padding-right:0.075in; padding-top:0in; padding-bottom:0in; border-width:0.0176cm; border-style:solid; border-color:#000000; writing-mode:lr-tb; }
	.Table3_A1 { vertical-align:top; background-color:#c0c0c0; padding-left:0.075in; padding-right:0.075in; padding-top:0in; padding-bottom:0in; border-width:0.0176cm; border-style:solid; border-color:#000000; writing-mode:lr-tb; }
	.Table1_A { width:5.3306in; }
	.Table2_A { width:5.3201in; }
	.Table3_A { width:5.3146in; }
	.T1 { font-weight:bold; }
	.T16 { color:#0000ff; }
	.T17 { color:#0000ff; }
	.T18 { color:#0000ff; }
	.T19 { color:#0000ff; }
	.T2 { font-weight:bold; }
	.T20 { font-size:9pt; }
	.T21 { color:#800000; }
	.T24 { font-size:10.5pt; }
	.T4 { background-color:#c0c0c0; }
	.T6 { color:#000000; background-color:#ffffff; }
	.T7 { color:#000000; background-color:#ffffff; }
	.T9 { background-color:#c0c0c0; }
	.底纹1_20_Char { font-family:Times New Roman; }
	.标题5_20_Char { font-size:10.5pt; font-weight:bold; }
	.注释标题1_20_Char { color:#800000; }
	<!-- ODF styles with no properties representable as CSS -->
	.Table1.1 .Table2.1 .Table3.1 .T10 .T11 .T12 .T13 .T14 .T15 .T22 .T23 .T3 .T5 .T8 { }
	</style></head><body dir="ltr" style="max-width:8.2681in;margin-top:1in; margin-bottom:1in; margin-left:1.25in; margin-right:1.25in; writing-mode:lr-tb; "><h1 class="P13"><a id="a__Python_Crawler_Manual_"><span/></a>Python Crawler Manual:</h1><p class="P1"> </p><h2 class="P14"><a id="a__1__Requirements_"><span/></a>1. Requirements:</h2><h3 class="P15"><a id="a__1__Python_Packages_"><span/></a>1.)Python Packages:</h3><p class="P4"><span class="T1">python-redis:</span> Python persistent object library based on Redis.  </p><p class="P3"><span class="T2">DBUtils:</span><span class="T3"> </span><span class="T6">The Commons DbUtils library is a small set of classes designed to </span><span class="T7">        </span><span class="T6">make working with</span><span class="T7"> JDBC</span><span class="T6"> easier</span><span class="T7">, and provide the ability to use the connection         pool in python.</span></p><p class="P4"><span class="T1">MySQLdb:</span> MySQLdb is a Python DB API-2.0-compliant interface.</p><p class="P4"><span class="T1">lxml:</span> the most feature-rich and easy-to-use library for processing XML and <span> HTML in the Python language. </span></p><p class="P4"><span class="T1">Psutil:</span> Psutil is a module providing an interface for retrieving information on <span> all running processes and system utilization (CPU, memory, disks, network, </span><span> users) in a portable way by using Python.</span></p><p class="P4"><span class="T1">Samplejson, urllib2, PIL</span>.</p><h3 class="P15"><a id="a__2__Redis_install_"><span/></a>2.)Redis install: </h3><p class="P4">Usually, 8GB memory should preserve to redis-server.</p><p class="P3"><span class="注释标题1_20_Char"><span class="T3">Note: </span></span><span class="T3">Intalling guide attached in document [1]</span></p><h3 class="P15"><a id="a__3__MySQL_"><span/></a>3.)MySQL:</h3><p class="P4"><span class="T8"> </span>A default max_connections value should be setted as 300(25 * 36) at least, but 1000 is recommended, also it's a optimal mount to live with other mysql-connection consumption processes.</p><p class="P1"> </p><h2 class="P14"><a id="a__2__Configures_"><span/></a>2. Configures:</h2><h3 class="P15"><a id="a__1__Redis_configure_"><span/></a>1.)Redis configure: </h3><p class="P4">Detailed statement shown in attached document [1].</p><p class="P3"><span class="注释标题1_20_Char"><span class="T3">Note: </span></span><span class="T3">Usually don't try to change any parameter once it's configured well. If you want to migrate the redis-server and data, you could simply copy the configure file and data files which specified in the document [1].</span></p><h3 class="P15"><a id="a__2__Mysql_configure_"><span/></a>2.)Mysql configure:</h3><p class="P4"><span class="T8"> </span>Using <span class="底纹1_20_Char"><span class="T9">"set GLOBAL max_connections=1000"</span></span> to set the mysql's max_connections option.</p><p class="P3"><span class="注释标题1_20_Char"><span class="T3">Note: </span></span><span class="T3">Usually don't try to change any parameter once it's configured well.</span></p><h3 class="P15"><a id="a__3__BlogCrawler_configure_"><span/></a>3.)BlogCrawler configure:</h3><p class="P4">The following items in ***settings.py represents:</p><table border="0" cellspacing="0" cellpadding="0" class="Table1"><colgroup><col width="592"/></colgroup><tr class="Table11"><td style="text-align:left;width:5.3306in; " class="Table1_A1"><p class="P5_borderStart"><span class="标题5_20_Char"><span class="T3">a.) mysqlsettings:</span></span><span class="T12"> host, port, user, passwd, db and charset are required.</span></p><p class="P6"><span class="T8">  </span>Note: utf8 shall be a good choice for charset</p><p class="P5"><span class="标题5_20_Char"><span class="T3">b.) redissettings:</span></span><span class="T12"> host, port and db are required</span></p><p class="P7"><span class="T15">  </span><span class="注释标题1_20_Char">Note: </span><span class="T10">setting db to be a separated number between crawlers is required, and a nonzero between 1 to 16 is recommended for db 0 is a default db that may lead to incorrect operation.</span></p><p class="P5"><span class="标题5_20_Char"><span class="T3">c.) blogcrawlersettings:</span></span></p><p class="P7"><span class="T15">  </span><span class="T17">page_url_set:</span><span class="T10"> A set that cache all the webpage urls' hash(url).</span></p><p class="P7"><span class="T15">  </span><span class="T18">n</span><span class="T17">othrow_urljson_list: </span><span class="T10">A queue cache the json of </span></p><p class="P5"><span class="T14">    </span><span class="T20">{'url': </span><span class="T21">'http://'</span><span class="T23">, </span><span class="T21">'pagetype'</span><span class="T23">: 2L, </span><span class="T21">'depth'</span><span class="T23">: 5, </span><span class="T21">'seed_id'</span><span class="T23">: 632L}</span></p><p class="P8"><span class="T13">  </span><span class="T19">image_url_set:</span><span class="T16"> </span><span class="T11">A set cache all the image urls' hash(url).</span></p><p class="P8"><span class="T13">  </span><span class="T19">process_no</span><span class="T16">:</span><span class="T11"> Define the number of the process to start initially.</span></p><p class="P8"><span class="T13">  </span><span class="T19">thread_no:</span><span class="T16"> </span><span class="T11">Define the number of the threads in each process.</span></p><p class="P8"><span class="T13">  </span><span class="T19">init_level:</span><span class="T16"> </span><span class="T11">Define the crawler's initialization level when starts, 0 means do </span></p><p class="P6"><span class="T8">  </span>nothing, 1 means deleting all the list and preserve all the set, 2 means </p><p class="P6"><span class="T8">  </span>deleting all the list and page_url_set , all the list and page_url_set, 3   </p><p class="P6"><span class="T8">  </span>means deleting all the lists and sets. </p><p class="P5"><span class="标题5_20_Char"><span class="T3">d.) foldersettings:</span></span><span class="T12"> Setting the folder to store the images, before setting the folder, you should confirm this folder containing all the sub-folders which sequentially generated from 000 to fff(a tri-Alphanumeric sequence)</span></p><p class="P5"><span class="标题5_20_Char"><span class="T3">e.) crawlertype:</span></span><span class="T12"> This parameter is same with photosourcetype_id in mysql's table crawlerseedurl, it means the photos' source, 2 presents coming from blog, 3 presents coming from product websites.</span></p><p class="P5_borderEnd"><span class="标题5_20_Char"><span class="T3">f.) depth_limit:</span></span><span class="T12"> To limit the crawler's depth.</span></p></td></tr></table><p class="P4">Note: Usually don't try to change any parameter once it's configured well.</p><p class="P4"> </p><h3 class="P15"><a id="a__4__Additional_configures_for_product_crawler_"><span/></a>4.)Additional configures for product crawler:</h3><p class="P4">For product crawler is desiged to crawl designated elements in pages, so in all the product seeds which marked by photosourcetype_id=3 in mysql table crawlerseedurl should contain the xpath corresponding to target element. The following sql should be executed after getting the xpath.</p><table border="0" cellspacing="0" cellpadding="0" class="Table2"><colgroup><col width="591"/></colgroup><tr class="Table21"><td style="text-align:left;width:5.3201in; " class="Table2_A1"><p class="P9_borderStart"><span class="T16">update </span><span class="T22">crawlerseedurl </span><span class="T16">set </span><span class="T22">photosourcetype_id=3 </span><span class="T16">where </span><span class="T22">url </span><span class="T16">like </span><span class="T22">"%your url%";</span></p><p class="P9"><span class="T16">update </span><span class="T22">crawlerseedurl  </span><span class="T16">set </span><span class="T22">detailurl_xpath="your xpath", nextpage_xpath="your xpath" </span><span class="T16">where </span><span class="T22">url </span><span class="T16">like </span><span class="T22">"%your url%";</span></p><p class="P9_borderEnd"><span class="T16">update </span><span class="T22">crawlerseedurl </span><span class="T16">set </span><span class="T22">TITLE_XPATH="", IMAGEURL_XPATH="", BRAND_XPATH="", DESCRIPTION_XPATH="", PRODUCTID_XPATH="", COLOR_XPATH="", PRICE_XPATH="", SIZE_XPATH="", MAINIMAGEURL_XPATH="" </span><span class="T16">where </span><span class="T22">url </span><span class="T16">like </span><span class="T22">"%your url%";</span></p></td></tr></table><p class="P10"><span class="注释标题1_20_Char"><span class="T3">Note:</span></span><span class="T3"> How to configure your robust xpath, you may need to reference document                 [2]</span></p><h2 class="P14"><a id="a__3__How_to_run_the_instance_of_the_crawler"><span/></a>3. How to run the instance of the crawler</h2><p class="P11">In the workstation(137.132.145.238), you could type the following command to start a crawler instance after configuring:</p><p class="P11"> </p><table border="0" cellspacing="0" cellpadding="0" class="Table3"><colgroup><col width="590"/></colgroup><tr class="Table31"><td style="text-align:left;width:5.3146in; " class="Table3_A1"><p class="P12">nohup python2 BlogCrawler.py &gt; output.file &amp;</p></td></tr></table><p class="P10"><span class="注释标题1_20_Char"><span class="T3"/></span></p><p class="P10"><span class="注释标题1_20_Char"><span class="T3">Note: </span></span><span class="T3">python2 means python2.6 for there are multiple python versioins installed in workstation. So if on your own machine, you just need to start the crawler intances by typing: </span><span class="底纹1_20_Char"><span class="T4">python BlogCrawler.py</span></span><span class="T3"> after intalling and configuring. </span></p><h2 class="P14"><a id="a__4__How_to_inspect_the_status_of_redis"><span/></a>4. How to inspect the status of redis</h2><p class="P11">1.)The most promptly way is using redis-cli to run the monitor command "<span class="T9">redis-cli monitor</span>", then all the command that running in redis-server could be observed immediately. But it's a resource consumption way. Usually you could get into the "<span class="T9">redis-cli</span>", and then use "<span class="T9">llen blog_nothrow_urljson_list</span>", "<span class="T9">scard blog_page_url_set</span>" and other similar commands to keep watch over the status of the redis-server and crawlers.</p><p class="P11">2.)The crawler's log file also provide a very straightforward way to moniter the crawlers.</p><p class="P11">3.)The Redis' log file is another way to inspect the status of the redis-server, you could get the connection number and the size of the data cached in redis, , you could use command "<span class="T9">sudo tail -f /var/log/redis_6379.log</span>"(change  the name according to your configure file name) to view the redis' log.</p><p class="P1"> </p><h2 class="P14"><a id="a__5__The_component_diagram"><span/></a>5. The component diagram</h2><p class="P11">Shown in attached document [3]</p><h2 class="P14"><a id="a__6__The_class_diagram"><span/></a>6. The class diagram</h2><p class="P11">Shown in attached document [4]</p><h2 class="P14"><a id="a__7__The_process_flow_diagram"><span/></a>7. The process flow diagram</h2><p class="P11">Shown in attached document [5]</p><p class="P1"> </p><p class="P1"> </p><h2 class="Heading_20_2"><a id="a__Appendix__"><span/></a><span class="T3">A</span>ppendix<span class="T5"> </span><span class="T3">:</span></h2><p class="P1">[1] Redis installing and configuring guide</p><p class="Standard"><a href="https://docs.google.com/file/d/0B79kk8CpytwrRmVILXZxODdBcGM/edit">https://docs.google.com/file/d/0B79kk8CpytwrRmVILXZxODdBcGM/edit</a><span class="T16">§</span><span class="T24"> </span></p><p class="P1">[2] How to configure your robust xpath</p><p class="P2"><a href="http://www.w3schools.com/xpath/xpath_syntax.asp">http://www.w3schools.com/xpath/xpath_syntax.asp</a>§</p><p class="P1">[3] </p><p class="P1">[4] </p><p class="P1">[5] </p></body></html>
